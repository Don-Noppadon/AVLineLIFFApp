<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
    <title>My LIFF App</title>
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>
    <div id="area">
        <!-- Logo -->
        <div class="center">
            <img src="logo/logo.png" width="90%" height="140" />
        </div>


        <!-- Head  -->
        <div class="center">
            <div class="head">
                <p>Avision LIFF</p>
            </div>
        </div>


        <!-- Line Picture -->
        <div class="center">
            <img id="pictureUrl" />
        </div>


        <!-- การ์ดข้อมูลส่วนตัว -->
        <div class="center">
            <div class="user_data">
                <div>
                    <table style="width: 100%">
                        <tr>
                            <td colspan="2" class="title" style="text-align: center;">ข้อมูลส่วนตัว</td>
                        </tr>
                        <tr>
                            <td class="title" style="width: 40%">ชื่อ-นามสกุล</td>
                            <td class="data" style="width: 60%" id="name"></td>
                        </tr>
                        <tr>
                            <td class="title" style="width: 40%">วันเดือนปีเกิด</td>
                            <td class="data" style="width: 60%" id="bdate">
                        </tr>
                        <tr>
                            <td class="title" style="width: 40%">เบอร์โทรศัพท์</td>
                            <td class="data" style="width: 60%" id="phone"></td>
                        </tr>
                        <tr>
                            <td class="title" style="width: 40%">อีเมล</td>
                            <td class="data" style="width: 60%">
                                <p id="getDecodedIDToken"></p>
                            </td>
                        </tr>
                        <tr>
                            <td class="title" style="width: 40%">ชื่อบัญชีผู้ใช้ไลน์</td>
                            <td class="data" style="width: 60%">
                                <p id="displayName"></p>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>


        <!-- button -->
        <div>
            <div class="center">
                <button class="button" onclick="location.href='user_data.html'">จัดการข้อมูลสมาชิก</button>
                <button class="button" onclick="location.href='contact.html'">ติดต่อ</button>
            </div>
            <div class="center">
                <div id="button-logOut"></div>
                <button class="button" id="button-testInsert">Test Insert</button>
                <button class="button" id="button-testSelect">Test Select</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyBY3ySD-bHbUiv2sysGEJP-YiD65BHCgVU",
          authDomain: "avlineliff-a9c35.firebaseapp.com",
          projectId: "avlineliff-a9c35",
          storageBucket: "avlineliff-a9c35.appspot.com",
          messagingSenderId: "584951879654",
          appId: "1:584951879654:web:0272a2d048d906610ea827",
          measurementId: "G-LNTJHG61FM"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        import {getDatabase, ref, get, set, child, update, remove} 
        from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js"; 
        
        const db = getDatabase(); 
        
        function Insertdata(){
            set(ref(db,"/LIFFMember/"+document.getElementById("displayName").value),{ 
                testname: document.getElementById("displayName").value,
                testemail: "test@gmail.com" 
            })
            .then(()=>{ 
                alert("data success");
            })
            .catch((error)=>{ 
                alert("Unsuccess,error"+error); 
            });            
        } 

        var InsBtn = document.getElementById("button-testInsert"); InsBtn.addEventListener('click',Insertdata);
        var SelBtn = document.getElementById("button-testSelect"); SelBtn.addEventListener('click',SelectData);

        function SelectData(){
            alert(document.getElementById("displayName"));
            const dbref = ref(db);

            get(child(dbref,"/LIFFMember/"+document.getElementById("displayName").value)).then((snapshot)=>{
                if(snapshot.exists()){
                    alert(snapshot.val().testname);
                }else{
                    alert("Not found"+document.getElementById("displayName").value)
                }
            }).catch((error)=>{ 
                alert("Unsuccess,error"+error); 
            }); 
        }

      </script>
</body>

</html>


<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="liff.js"></script>